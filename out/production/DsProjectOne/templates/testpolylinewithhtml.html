<!DOCTYPE html>
<html>

<body>
<!--<h1>"this is a test" <h1/>-->
<h2>Enter Source and Destination Below</h2>
<form method="POST">
    <p1>Source</p1>
    <input name="source">
    <p1>Destination</p1>
    <input name="destination">
    <p1></p1>
    <input type="submit">
</form>

<div id="map-canvas" style="width:100%;height:700px"></div>

<div id="directions-panel"></div>


<script>
    function myMap() {

        var directionsService = new google.maps.DirectionsService;
        var directionsDisplay = new google.maps.DirectionsRenderer({suppressMarkers: true});
        // code to supress the markers generated by the way points code

        JSON.parse("{}");
        console.log("{{food}}");
        var a = "{{food}}";
        console.log(a);
        console.log(typeof a);
        console.log(JSON.parse('{{ food | tojson | safe}}'));
        var food = JSON.parse('{{ food | tojson | safe}}')


        var myCenter = new google.maps.LatLng(51.508742,-0.120850);
        var stavanger = new google.maps.LatLng(58.983991,5.734863);
        var amsterdam = new google.maps.LatLng(52.395715,4.888916);
        var london = new google.maps.LatLng(51.508742,-0.120850);
        var mapCanvas = document.getElementById("map-canvas");
        var mapOptions = { center: myCenter,zoom: 5};
        var map = new google.maps.Map(mapCanvas, mapOptions);

        var marker = new google.maps.Marker({position:myCenter});
        var stavangermarker = new google.maps.Marker({position:stavanger});
        var amsterdammarker = new google.maps.Marker({position:amsterdam});
        var londonmarker = new google.maps.Marker({position:london});


        var waypts = [];

        waypts.push({
            location: stavanger,
            stopover: true
        });
        waypts.push({
            location: amsterdam,
            stopover: true
        });
        waypts.push({
            location: london,
            stopover: true
        });


        directionsDisplay.setMap(map);

        function calculateAndDisplayRoute(directionsService, directionsDisplay) {


            directionsService.route({
                // origin: document.getElementById('start').value,
                // destination: document.getElementById('end').value,
                origin: myCenter,
                destination: stavanger,
                waypoints: waypts,
                optimizeWaypoints: true,
                travelMode: 'DRIVING'
            }, function(response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);

                    var route = response.routes[0];
                    console.log(response)
                    var summaryPanel = document.getElementById('directions-panel');
                    summaryPanel.innerHTML = '';
                    // For each route, display summary information.
                    for (var i = 0; i < route.legs.length; i++) {
                        var routeSegment = i + 1;
                        summaryPanel.innerHTML += '<b>Route Segment: ' + routeSegment +
                            '</b><br>';
                        summaryPanel.innerHTML += route.legs[i].start_address + ' to i am putting temperature here ';
                        summaryPanel.innerHTML += route.legs[i].end_address + '<br>';
                        summaryPanel.innerHTML += route.legs[i].distance.text + '<br><br>';
                    }
                } else {
                    window.alert('Directions request failed due to ' + status);
                    console.log('Directions request failed due to ' + status)
                }
            });
        }
        console.log("logging food" + food)
        calculateAndDisplayRoute(directionsService, directionsDisplay);


        stavangermarker.setMap(map);
        amsterdammarker.setMap(map);
        londonmarker.setMap(map);

        var source = '{{source}}'
        var destination = '{{destination}}'
        console.log(source)
        console.log(destination)

        // var testFood = JSON.parse(food)

        google.maps.event.addListener(londonmarker,'click',function() {
            var infowindow = new google.maps.InfoWindow({
                content: food.testStrigification
                // content: testFood['test']
            });
            infowindow.open(map,londonmarker);
        });

        google.maps.event.addListener(amsterdammarker,'click',function() {
            var infowindow = new google.maps.InfoWindow({
                content: "hardcoded thing"
            });
            infowindow.open(map,amsterdammarker);
        });
        google.maps.event.addListener(stavangermarker,'click',function() {
            var infowindow = new google.maps.InfoWindow({
                content:"Hello stavangermarker!"
            });
            infowindow.open(map,stavangermarker);
        });


    }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAHTyu1nDtzoV2OV4IFfHgm09C7wM_J1Ww&callback=myMap"></script>
<!--
To use this code on your website, get a free API key from Google.
Read more at: https://www.w3schools.com/graphics/google_maps_basic.asp
-->

</body>
</html>

